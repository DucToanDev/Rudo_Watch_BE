# Bật công cụ Rewrite
RewriteEngine On

# OPcache Configuration - Tối ưu performance
<IfModule mod_php.c>
    php_value opcache.enable 1
    php_value opcache.memory_consumption 128
    php_value opcache.interned_strings_buffer 8
    php_value opcache.max_accelerated_files 10000
    php_value opcache.revalidate_freq 2
    php_value opcache.fast_shutdown 1
    php_value opcache.enable_cli 0
</IfModule>

# XÓA CORS headers từ Apache config - để PHP xử lý hoàn toàn
<IfModule mod_headers.c>
    Header unset Access-Control-Allow-Origin
    Header unset Access-Control-Allow-Methods
    Header unset Access-Control-Allow-Headers
    Header unset Access-Control-Max-Age
</IfModule>

# Base path - uncomment nếu cần
# RewriteBase /backend/

# Pass Authorization header cho FastCGI/PHP
RewriteCond %{HTTP:Authorization} .
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Handle OPTIONS preflight requests - redirect to index.php để PHP xử lý CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ index.php [L]

# Bỏ qua các file hoặc thư mục đã tồn tại
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Chuyển hướng tất cả các request khác đến index.php
RewriteRule ^(.*)$ index.php?url=$1 [L,QSA]